<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Registro de Clientes</title>
  <!DOCTYPE html>
  <html lang="es">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Clientes</title>
    <link rel="stylesheet" href="/portal/inicio.css">
    <style>
      /* ====== Modal ====== */
      .modal-politica {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0; top: 0;
        width: 100%; height: 100%;
        background: rgba(0,0,0,0.6);
      }
      .modal-politica-content {
        background: #6c3ef5;
        margin: 10% auto;
        padding: 20px;
        width: 60%;
        border-radius: 10px;
        box-shadow: 0 0 10px #000;
      }
      .close-politica {
        float: right;
        font-size: 22px;
        font-weight: bold;
        cursor: pointer;
      }
      .close-politica:hover {
        color: red;
      }
    </style>
  </head>
  <body>

    <div class="form-container">
      <h2>Registro de Cliente</h2>
      <form id="formRegistro">
        <label for="nombre">Nombre:</label>
        <input type="text" id="nombre" name="nombre" placeholder="Ingrese su nombre" required>

        <label for="apellido">Apellido:</label>
        <input type="text" id="apellido" name="apellido" placeholder="Ingrese su apellido" required>

        <label for="email">Correo:</label>
        <input type="email" id="email" name="email" placeholder="Ingrese su correo" required>

        <label for="telefono">Tel√©fono:</label>
        <input type="text" id="telefono" name="telefono" placeholder="Ingrese su tel√©fono" required maxlength="10">

        <label for="contrase√±a">Contrase√±a:</label>
        <div class="password-wrapper">
          <input type="password" id="contrase√±a" name="contrase√±a" placeholder="Ingrese su contrase√±a" required>
          <span class="toggle-eye" id="toggleContrase√±a">üëÅÔ∏è</span>
        </div>

        <label for="confirmarContrase√±a">Confirmar Contrase√±a:</label>
        <div class="password-wrapper">
          <input type="password" id="confirmarContrase√±a" name="confirmarContrase√±a" placeholder="Confirme su contrase√±a" required>
          <span class="toggle-eye" id="toggleConfirmarContrase√±a">üëÅÔ∏è</span>
        </div>

        <!-- üîπ Enlace a pol√≠tica -->
        <div style="margin: 15px 0;">
          <a href="#" id="verPolitica">
            üìÑ Ver Pol√≠tica de Privacidad y T√©rminos
          </a>
        </div>

        <!-- üîπ Checkbox actual -->
        <label>
          <input type="checkbox" id="aceptaTerminos" required>
          Acepto los t√©rminos y la pol√≠tica de privacidad
        </label>

        <!-- üîπ NUEVO: Checkbox y texto desplegable de Suono Logistic -->
        <label>
          <input type="checkbox" id="consentimiento" required>
          Acepto los <a href="#" id="toggleTerminos">T√©rminos y Condiciones</a>.
        </label>

        <div id="textoTerminos" style="display:none; margin-top:10px; padding:10px; border:1px solid #ccc;">
          <h3>T√©rminos y Condiciones</h3>
          <p>Sus datos ser√°n tratados seg√∫n la Ley 1581 de 2012...</p>
          <p>Al aceptar, usted autoriza a <b>Suono Logistic</b> a usar sus datos para gesti√≥n de eventos, reservas, etc.</p>
        </div>

        <button type="submit">Registrar</button>
        <p id="errorMensaje" style="color:red;"></p>
      </form>
    </div>

    <!-- üîπ Modal de registro exitoso -->
    <div class="modal" id="modalExito">
      <div class="modal-content">
        <h2>Registro exitoso</h2>
        <button id="cerrarModal">Continuar</button>
      </div>
    </div>

    <!-- üîπ Modal de Pol√≠tica -->
    <div class="modal-politica" id="modalPolitica">
      <div class="modal-politica-content">
        <span id="cerrarPolitica" class="close-politica">&times;</span>
        <h2>Pol√≠tica de Privacidad y T√©rminos</h2>
        <p>
          En Suono Logistic nos comprometemos a proteger sus datos.  
          Toda la informaci√≥n ser√° tratada conforme a la Ley 1581 de 2012 y normativas vigentes.  
        </p>
        <p>
          Al registrarse, usted acepta el uso de sus datos √∫nicamente para gesti√≥n de eventos, reservas y comunicaci√≥n comercial relacionada.
        </p>
        <p>
          Puede solicitar en cualquier momento la eliminaci√≥n de sus datos escribiendo a nuestro correo oficial.
        </p>
      </div>
    </div>

    <script>
      // Inputs
      const nombreInput = document.getElementById("nombre");
      const apellidoInput = document.getElementById("apellido");
      const emailInput = document.getElementById("email");
      const telefonoInput = document.getElementById("telefono");
      const contrase√±aInput = document.getElementById("contrase√±a");
      const confirmarContrase√±aInput = document.getElementById("confirmarContrase√±a");
      const aceptaTerminos = document.getElementById("aceptaTerminos");
      const consentimiento = document.getElementById("consentimiento");
      const errorMensaje = document.getElementById("errorMensaje");

      // Modal registro
      const modal = document.getElementById("modalExito");
      const cerrarModal = document.getElementById("cerrarModal");

      // Modal pol√≠tica
      const modalPolitica = document.getElementById("modalPolitica");
      const btnPolitica = document.getElementById("verPolitica");
      const cerrarPolitica = document.getElementById("cerrarPolitica");

      // Iconos de ojo
      const toggleContrase√±a = document.getElementById("toggleContrase√±a");
      const toggleConfirmarContrase√±a = document.getElementById("toggleConfirmarContrase√±a");

      // Evitar n√∫meros o s√≠mbolos en nombre y apellido
      [nombreInput, apellidoInput].forEach(input => {
        input.addEventListener("input", function() {
          this.value = this.value.replace(/[^A-Za-z√Å√â√ç√ì√ö√°√©√≠√≥√∫√ë√± ]/g, '');
        });
      });

      // Evitar letras en tel√©fono
      telefonoInput.addEventListener("input", function() {
        this.value = this.value.replace(/\D/g, '');
      });

      // Validaci√≥n de coincidencia de contrase√±as en tiempo real
      confirmarContrase√±aInput.addEventListener("input", function() {
        if (contrase√±aInput.value !== confirmarContrase√±aInput.value) {
          errorMensaje.textContent = "Las contrase√±as no coinciden.";
        } else {
          errorMensaje.textContent = "";
        }
      });

      // Toggle contrase√±a y cambio de emoji
      function togglePassword(input, icon) {
        if (input.type === "password") {
          input.type = "text";
          icon.textContent = "üôà"; // ojo abierto
        } else {
          input.type = "password";
          icon.textContent = "üëÅÔ∏è"; // ojo cerrado
        }
      }

      toggleContrase√±a.addEventListener("click", () => togglePassword(contrase√±aInput, toggleContrase√±a));
      toggleConfirmarContrase√±a.addEventListener("click", () => togglePassword(confirmarContrase√±aInput, toggleConfirmarContrase√±a));

      // Toggle mostrar/ocultar texto de t√©rminos
      document.getElementById("toggleTerminos").addEventListener("click", (e)=>{
        e.preventDefault();
        const box = document.getElementById("textoTerminos");
        box.style.display = box.style.display === "none" ? "block" : "none";
      });

      // Mostrar modal de √©xito
      function mostrarModalExito() {
        modal.classList.add("show");
      }

      // Cerrar modal √©xito y redirigir
      cerrarModal.onclick = function() {
        modal.classList.remove("show");
        setTimeout(() => {
          window.location.href = "/portal/panel_cliente.html";
        }, 300);
      };

      window.onclick = function(event) {
        if (event.target === modal) {
          modal.classList.remove("show");
          setTimeout(() => {
            window.location.href = "/portal/panel_cliente.html";
          }, 300);
        }
        if (event.target === modalPolitica) {
          modalPolitica.style.display = "none";
        }
      };

      // Abrir modal pol√≠tica
      btnPolitica.addEventListener("click", (e) => {
        e.preventDefault();
        modalPolitica.style.display = "block";
      });

      // Cerrar modal pol√≠tica
      cerrarPolitica.addEventListener("click", () => {
        modalPolitica.style.display = "none";
      });

      // Validaci√≥n y env√≠o al backend
      document.getElementById("formRegistro").addEventListener("submit", async function(e) {
        e.preventDefault();

        const nombre = nombreInput.value.trim();
        const apellido = apellidoInput.value.trim();
        const email = emailInput.value.trim();
        const telefono = telefonoInput.value.trim();
        const contrase√±a = contrase√±aInput.value;
        const confirmarContrase√±a = confirmarContrase√±aInput.value;
        const acepta = aceptaTerminos.checked;
        const consiente = consentimiento.checked;

        if (!nombre) { errorMensaje.textContent = "Ingrese su nombre."; return; }
        if (!apellido) { errorMensaje.textContent = "Ingrese su apellido."; return; }

        const correoValido = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        if (!correoValido) { errorMensaje.textContent = "Ingrese un correo v√°lido."; return; }

        const telefonoValido = /^\d{1,10}$/.test(telefono);
        if (!telefonoValido) { errorMensaje.textContent = "El tel√©fono debe tener m√°ximo 10 d√≠gitos y solo n√∫meros."; return; }

        if (contrase√±a.length < 8) { errorMensaje.textContent = "La contrase√±a debe tener m√≠nimo 8 caracteres."; return; }
        if (contrase√±a !== confirmarContrase√±a) { errorMensaje.textContent = "Las contrase√±as no coinciden."; return; }

        if (!acepta) { errorMensaje.textContent = "Debes aceptar la pol√≠tica de privacidad."; return; }
        if (!consiente) { errorMensaje.textContent = "Debes aceptar los T√©rminos y Condiciones de Suono Logistic."; return; }

        try {
    const res = await fetch("/api/cliente/registro", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              nombre,
              apellido,
              email,
              telefono,
              password: contrase√±a,
              aceptaTerminos: acepta,
              consentimiento: consiente
            })
          });

          const data = await res.json();

          if (res.ok) {
            errorMensaje.textContent = "";
            this.reset();
            mostrarModalExito();
          } else {
            errorMensaje.textContent = data.mensaje || "Error al registrar cliente.";
          }
        } catch (err) {
          console.error(err);
          errorMensaje.textContent = "Error de conexi√≥n con el servidor.";
        }
      });
    </script>

  </body>
  <script src="panelCliente.js"></script>
  </html>
